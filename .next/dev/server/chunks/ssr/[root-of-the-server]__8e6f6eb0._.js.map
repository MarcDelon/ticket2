{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/marcn/OneDrive/Desktop/v0-event-ticket-app-main/app/scan/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { useState, useRef, useEffect } from \"react\"\nimport { ArrowLeft, Loader } from \"lucide-react\"\nimport Link from \"next/link\"\nimport jsQR from \"jsqr\"\n\nexport default function ScanPage() {\n  const videoRef = useRef<HTMLVideoElement>(null)\n  const canvasRef = useRef<HTMLCanvasElement>(null)\n  const [scanning, setScanning] = useState(false)\n  const [result, setResult] = useState<{\n    type: \"success\" | \"error\" | \"used\"\n    message: string\n    ticketId?: string\n  } | null>(null)\n  const [isCameraReady, setIsCameraReady] = useState(false)\n\n  useEffect(() => {\n    startCamera()\n  }, [])\n\n  useEffect(() => {\n    if (!isCameraReady || !scanning) return\n\n    const interval = setInterval(() => {\n      scanQRCode()\n    }, 500)\n\n    return () => clearInterval(interval)\n  }, [scanning, isCameraReady])\n\n  const startCamera = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { facingMode: \"environment\" },\n      })\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream\n        videoRef.current.onloadedmetadata = () => {\n          setIsCameraReady(true)\n          setScanning(true)\n        }\n      }\n    } catch (err) {\n      setResult({ type: \"error\", message: \"Camera access denied\" })\n    }\n  }\n\n  const scanQRCode = () => {\n    if (!videoRef.current || !canvasRef.current) return\n\n    const canvas = canvasRef.current\n    const ctx = canvas.getContext(\"2d\")\n    if (!ctx) return\n\n    canvas.width = videoRef.current.videoWidth\n    canvas.height = videoRef.current.videoHeight\n\n    ctx.drawImage(videoRef.current, 0, 0)\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)\n    const code = jsQR(imageData.data, imageData.width, imageData.height)\n\n    if (code) {\n      processTicket(code.data)\n      setScanning(false)\n    }\n  }\n\n  const processTicket = (ticketId: string) => {\n    const tickets = JSON.parse(localStorage.getItem(\"tickets\") || \"[]\")\n    const scannedTickets = JSON.parse(localStorage.getItem(\"scannedTickets\") || \"[]\")\n\n    const ticket = tickets.find((t: any) => t.id === ticketId)\n\n    if (!ticket) {\n      setResult({ type: \"error\", message: \"Invalid ticket\" })\n      return\n    }\n\n    if (scannedTickets.includes(ticketId)) {\n      setResult({ type: \"used\", message: \"Ticket already used\" })\n      return\n    }\n\n    scannedTickets.push(ticketId)\n    localStorage.setItem(\"scannedTickets\", JSON.stringify(scannedTickets))\n\n    setResult({\n      type: \"success\",\n      message: `Welcome ${ticket.participantName}!`,\n      ticketId,\n    })\n  }\n\n  const resetScan = () => {\n    setResult(null)\n    setScanning(true)\n  }\n\n  return (\n    <main className=\"min-h-screen bg-white\">\n      {/* Header */}\n      <header className=\"border-b border-gray-200 bg-white sticky top-0 z-50\">\n        <div className=\"max-w-2xl mx-auto px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between gap-2\">\n          <Link\n            href=\"/\"\n            className=\"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors flex-shrink-0 font-light text-sm sm:text-base\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Back</span>\n          </Link>\n          <h1 className=\"text-base sm:text-lg font-light text-gray-900 text-center flex-1 truncate tracking-tight\">\n            Scan QR Code\n          </h1>\n          <div className=\"w-10 flex-shrink-0\"></div>\n        </div>\n      </header>\n\n      <div className=\"max-w-2xl mx-auto px-4 sm:px-6 py-6 sm:py-8\">\n        <div\n          className=\"relative rounded overflow-hidden border-2 border-blue-600 bg-black mb-6 w-full\"\n          style={{ aspectRatio: \"16 / 9\" }}\n        >\n          <video ref={videoRef} autoPlay playsInline className=\"w-full h-full object-cover\" />\n          <canvas ref={canvasRef} className=\"hidden\" />\n\n          {!isCameraReady && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-black/50\">\n              <Loader className=\"w-8 h-8 text-blue-400 animate-spin\" />\n            </div>\n          )}\n\n          {scanning && isCameraReady && (\n            <div className=\"absolute inset-0 flex items-center justify-center\">\n              <div className=\"w-32 h-32 sm:w-48 sm:h-48 border-2 border-blue-400 rounded animate-pulse\"></div>\n            </div>\n          )}\n        </div>\n\n        {/* Result */}\n        {result && (\n          <div\n            className={`p-5 sm:p-6 rounded border-2 mb-6 ${\n              result.type === \"success\"\n                ? \"bg-blue-50 border-blue-600\"\n                : result.type === \"error\"\n                  ? \"bg-red-50 border-red-600\"\n                  : \"bg-amber-50 border-amber-600\"\n            }`}\n          >\n            <h3\n              className={`text-sm sm:text-base font-medium mb-2 ${\n                result.type === \"success\"\n                  ? \"text-blue-900\"\n                  : result.type === \"error\"\n                    ? \"text-red-900\"\n                    : \"text-amber-900\"\n              }`}\n            >\n              {result.type === \"success\" ? \"✓ Valid Ticket\" : result.type === \"error\" ? \"✗ Invalid\" : \"⚠ Already Used\"}\n            </h3>\n            <p className=\"text-gray-900 mb-3 text-xs sm:text-sm font-light\">{result.message}</p>\n            {result.ticketId && <p className=\"text-xs text-gray-600 font-mono break-all mb-4\">{result.ticketId}</p>}\n            <button\n              onClick={resetScan}\n              className=\"w-full px-6 py-2.5 rounded bg-blue-600 hover:bg-blue-700 text-white font-medium transition-colors text-xs sm:text-sm\"\n            >\n              Scan Next\n            </button>\n          </div>\n        )}\n\n        {/* Instructions */}\n        <div className=\"p-5 sm:p-6 rounded border border-gray-200 bg-gray-50\">\n          <h3 className=\"text-gray-900 font-medium mb-3 text-xs sm:text-sm\">Instructions</h3>\n          <ul className=\"space-y-2 text-gray-700 text-xs font-light\">\n            <li>• Allow camera access when prompted</li>\n            <li>• Point camera at the QR code</li>\n            <li>• Hold steady for automatic scan</li>\n            <li>• Valid tickets grant one-time entry</li>\n          </ul>\n        </div>\n      </div>\n    </main>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AACA;AALA;;;;;;AAOe,SAAS;IACtB,MAAM,WAAW,IAAA,8UAAM,EAAmB;IAC1C,MAAM,YAAY,IAAA,8UAAM,EAAoB;IAC5C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gVAAQ,EAAC;IACzC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,gVAAQ,EAI1B;IACV,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,gVAAQ,EAAC;IAEnD,IAAA,iVAAS,EAAC;QACR;IACF,GAAG,EAAE;IAEL,IAAA,iVAAS,EAAC;QACR,IAAI,CAAC,iBAAiB,CAAC,UAAU;QAEjC,MAAM,WAAW,YAAY;YAC3B;QACF,GAAG;QAEH,OAAO,IAAM,cAAc;IAC7B,GAAG;QAAC;QAAU;KAAc;IAE5B,MAAM,cAAc;QAClB,IAAI;YACF,MAAM,SAAS,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;gBACvD,OAAO;oBAAE,YAAY;gBAAc;YACrC;YACA,IAAI,SAAS,OAAO,EAAE;gBACpB,SAAS,OAAO,CAAC,SAAS,GAAG;gBAC7B,SAAS,OAAO,CAAC,gBAAgB,GAAG;oBAClC,iBAAiB;oBACjB,YAAY;gBACd;YACF;QACF,EAAE,OAAO,KAAK;YACZ,UAAU;gBAAE,MAAM;gBAAS,SAAS;YAAuB;QAC7D;IACF;IAEA,MAAM,aAAa;QACjB,IAAI,CAAC,SAAS,OAAO,IAAI,CAAC,UAAU,OAAO,EAAE;QAE7C,MAAM,SAAS,UAAU,OAAO;QAChC,MAAM,MAAM,OAAO,UAAU,CAAC;QAC9B,IAAI,CAAC,KAAK;QAEV,OAAO,KAAK,GAAG,SAAS,OAAO,CAAC,UAAU;QAC1C,OAAO,MAAM,GAAG,SAAS,OAAO,CAAC,WAAW;QAE5C,IAAI,SAAS,CAAC,SAAS,OAAO,EAAE,GAAG;QACnC,MAAM,YAAY,IAAI,YAAY,CAAC,GAAG,GAAG,OAAO,KAAK,EAAE,OAAO,MAAM;QACpE,MAAM,OAAO,IAAA,gMAAI,EAAC,UAAU,IAAI,EAAE,UAAU,KAAK,EAAE,UAAU,MAAM;QAEnE,IAAI,MAAM;YACR,cAAc,KAAK,IAAI;YACvB,YAAY;QACd;IACF;IAEA,MAAM,gBAAgB,CAAC;QACrB,MAAM,UAAU,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,cAAc;QAC9D,MAAM,iBAAiB,KAAK,KAAK,CAAC,aAAa,OAAO,CAAC,qBAAqB;QAE5E,MAAM,SAAS,QAAQ,IAAI,CAAC,CAAC,IAAW,EAAE,EAAE,KAAK;QAEjD,IAAI,CAAC,QAAQ;YACX,UAAU;gBAAE,MAAM;gBAAS,SAAS;YAAiB;YACrD;QACF;QAEA,IAAI,eAAe,QAAQ,CAAC,WAAW;YACrC,UAAU;gBAAE,MAAM;gBAAQ,SAAS;YAAsB;YACzD;QACF;QAEA,eAAe,IAAI,CAAC;QACpB,aAAa,OAAO,CAAC,kBAAkB,KAAK,SAAS,CAAC;QAEtD,UAAU;YACR,MAAM;YACN,SAAS,CAAC,QAAQ,EAAE,OAAO,eAAe,CAAC,CAAC,CAAC;YAC7C;QACF;IACF;IAEA,MAAM,YAAY;QAChB,UAAU;QACV,YAAY;IACd;IAEA,qBACE,6WAAC;QAAK,WAAU;;0BAEd,6WAAC;gBAAO,WAAU;0BAChB,cAAA,6WAAC;oBAAI,WAAU;;sCACb,6WAAC,sSAAI;4BACH,MAAK;4BACL,WAAU;;8CAEV,6WAAC,iTAAS;oCAAC,WAAU;;;;;;8CACrB,6WAAC;oCAAK,WAAU;8CAAmB;;;;;;;;;;;;sCAErC,6WAAC;4BAAG,WAAU;sCAA2F;;;;;;sCAGzG,6WAAC;4BAAI,WAAU;;;;;;;;;;;;;;;;;0BAInB,6WAAC;gBAAI,WAAU;;kCACb,6WAAC;wBACC,WAAU;wBACV,OAAO;4BAAE,aAAa;wBAAS;;0CAE/B,6WAAC;gCAAM,KAAK;gCAAU,QAAQ;gCAAC,WAAW;gCAAC,WAAU;;;;;;0CACrD,6WAAC;gCAAO,KAAK;gCAAW,WAAU;;;;;;4BAEjC,CAAC,+BACA,6WAAC;gCAAI,WAAU;0CACb,cAAA,6WAAC,oSAAM;oCAAC,WAAU;;;;;;;;;;;4BAIrB,YAAY,+BACX,6WAAC;gCAAI,WAAU;0CACb,cAAA,6WAAC;oCAAI,WAAU;;;;;;;;;;;;;;;;;oBAMpB,wBACC,6WAAC;wBACC,WAAW,CAAC,iCAAiC,EAC3C,OAAO,IAAI,KAAK,YACZ,+BACA,OAAO,IAAI,KAAK,UACd,6BACA,gCACN;;0CAEF,6WAAC;gCACC,WAAW,CAAC,sCAAsC,EAChD,OAAO,IAAI,KAAK,YACZ,kBACA,OAAO,IAAI,KAAK,UACd,iBACA,kBACN;0CAED,OAAO,IAAI,KAAK,YAAY,mBAAmB,OAAO,IAAI,KAAK,UAAU,cAAc;;;;;;0CAE1F,6WAAC;gCAAE,WAAU;0CAAoD,OAAO,OAAO;;;;;;4BAC9E,OAAO,QAAQ,kBAAI,6WAAC;gCAAE,WAAU;0CAAkD,OAAO,QAAQ;;;;;;0CAClG,6WAAC;gCACC,SAAS;gCACT,WAAU;0CACX;;;;;;;;;;;;kCAOL,6WAAC;wBAAI,WAAU;;0CACb,6WAAC;gCAAG,WAAU;0CAAoD;;;;;;0CAClE,6WAAC;gCAAG,WAAU;;kDACZ,6WAAC;kDAAG;;;;;;kDACJ,6WAAC;kDAAG;;;;;;kDACJ,6WAAC;kDAAG;;;;;;kDACJ,6WAAC;kDAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMhB"}}]
}